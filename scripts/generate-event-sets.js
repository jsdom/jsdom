"use strict";
const fs = require("node:fs");
const path = require("node:path");
const webidl2 = require("webidl2");

const idlDir = path.resolve(__dirname, "../lib/jsdom/living/nodes");
const dest = path.resolve(__dirname, "../lib/generated/event-sets.js");

function extractEventNames(idlPath) {
  const idlText = fs.readFileSync(idlPath, "utf-8");
  const tree = webidl2.parse(idlText);

  const events = [];
  for (const node of tree) {
    if (node.type === "interface mixin") {
      for (const member of node.members) {
        if (member.type === "attribute" && member.name.startsWith("on")) {
          events.push(member.name.slice(2));
        }
      }
    }
  }
  return events;
}

const globalEvents = extractEventNames(path.resolve(idlDir, "GlobalEventHandlers.webidl"));
const windowEvents = extractEventNames(path.resolve(idlDir, "WindowEventHandlers.webidl"));

fs.mkdirSync(path.dirname(dest), { recursive: true });

const output = `// This file is generated by scripts/generate-event-sets.js. Do not edit.

"use strict";

exports.globalEventHandlersEvents = new Set(${JSON.stringify(globalEvents, undefined, 2)});

exports.windowEventHandlersEvents = new Set(${JSON.stringify(windowEvents, undefined, 2)});
`;

fs.writeFileSync(dest, output);
